let seller,currentCardId,editMode=!1;$.ajax({url:"./config.json",type:"GET",dataType:"json",success:function(e){url=`${e.SERVER_URL}:${e.SERVER_PORT}`,console.log(url),getListingData()},error:function(){console.log("Cant connect to server, need the config file")}}),sessionStorage.userID?(console.log("you are logged in "),$("#login").hide(),$("#regoBtn").hide(),$("#logout").removeClass("d-none"),$("#cardModal").addClass("shadowCard")):(console.log("please sign in"),$("#userFeatures").hide(),$("#cardModal").removeClass("shadow")),console.log(sessionStorage),$("#register").click(function(){event.preventDefault(),console.log("button clicked");let e=$("#username").val(),n=$("#password").val(),o=$("#email").val();$.ajax({url:`${url}/users`,type:"POST",data:{username:e,password:n,email:o},success:function(e){console.log(e),$("#rego").addClass("d-none"),$("#signIn").removeClass("d-none")},error:function(e){console.log(`${url}/users`),console.log(e),console.log("something went wrong with registering user")}})}),$("#login").click(function(){let e=$("#lUsername").val(),n=$("#lPassword").val();$.ajax({url:`${url}/userLogin`,type:"POST",data:{username:e,password:n},success:function(e){"invalid user"===e?console.log("Sorry, we couldn't find a user with that username."):"invalid password"===e?console.log("Incorrect password"):(console.log("Login successful"),sessionStorage.setItem("userID",e._id),sessionStorage.setItem("userName",e.username),seller=sessionStorage.userName,console.log(seller),$("#lUsername").val(null),$("#lPassword").val(null))},error:function(e){console.log(e),console.log("Couldn't log you in")}})}),$("#logout").click(function(){sessionStorage.userID?(console.log("logout successful"),sessionStorage.clear()):console.log("You don't have permission to access. Please sign in.")}),getListingData=(()=>{$.ajax({url:`${url}/allListings`,type:"GET",success:function(e){for(var n=0;n<e.length;n++)$(".listingDisplay").append(`\n        <div class="card cardListStyle mb-4 listingCard" id="${e[n]._id}" data-toggle="modal" data-target="#listingModel" data-id="${e[n]._id}">\n          <div>\n            <img class="listingsImg" src="${url}/${e[n].itemImage}" class="card-img-top">\n          </div>\n\n          <div class="card-body d-flex justify-content-between flex-row">\n            <div class="col-8 col-sm-8 px-1">\n              <h6 class="card-title"> ${e[n].itemName}</h6>\n            </div>\n            <div class="col-4 col-sm-4 border-left px-1">\n              <small class="text-muted pl-2">$${e[n].itemPrice}</small>\n            </div>\n          </div>\n        </div>\n      `)},error:function(e){console.log(e),console.log("something went wrong with getting all the products")}})}),getCommentData=(()=>{$.ajax({url:`${url}/allComments`,type:"GET",success:function(e){$("#commentsDisplay").empty();for(var n=0;n<e.length;n++)e[n].commentID===currentCardId&&($("#comments").val(null),$("#commentsDisplay").append(`\n            <div id="commentsCard" class="col-12">\n              <div class="card mb-4 shadow-sm">\n                <div class="card-body " id="commentBody">\n                  <p class="card-text">${e[n].commentDescription}</p>\n                  </div>\n              </div>\n            </div>\n          `))},error:function(e){console.log(e),console.log("something went wrong with getting all the products")}})}),$("#cardsAndComment").on("click",".deleteBtn",function(){sessionStorage.userID?(event.preventDefault(),$("#myModal").modal("hide"),$.ajax({url:`${url}/listing/${currentCardId}`,type:"DELETE",data:{userId:sessionStorage.userID},success:function(e){document.getElementById(currentCardId).remove()},error:function(e){console.log(e),console.log("something went wrong deleting the product")}})):console.log("You don't have permission to delete this item. Please sign in.")}),$("#cardsAndComment").on("click",".editBtn",function(){editMode=!0,sessionStorage.userID?(event.preventDefault(),$("#myModal").modal("hide"),$("#addListingModal").modal("show"),$("#exampleModalLabel").text("Edit listing"),$.ajax({url:`${url}/listing/${currentCardId}`,type:"get",data:{userId:sessionStorage.userID},dataType:"json",success:function(e){console.log(e),$("#itemName").val(e.itemName),$("#itemImage").val(e.fileName),$("#itemPrice").val(e.itemPrice),$("#itemDescription").val(e.itemDescription)},error:function(e){console.log(e),console.log("something went wrong with getting the single item")}})):$(".editBtn").hide()}),$("#submitNewListing").click(function(){let e=$("#itemName").val(),n=$("#itemPrice").val(),o=($("#itemDescription").val(),$("#itemImage").val()),s=new FormData;const t=$("#itemImage")[0].files[0];s.append("uploadImage",t),s.append("itemName",e),s.append("itemPrice",n),s.append("itemImage",o),console.log(s),!0===editMode?(console.log("you are editing"),console.log(currentCardId),$.ajax({url:`${url}/listing/${currentCardId}`,type:"PATCH",data:s,processData:!1,contentType:!1,success:function(e){console.log(e)},error:function(e){console.log(e),console.log("something went wrong with sending the data")}})):(console.log("you are adding"),$.ajax({url:`${url}/listing`,type:"POST",data:s,processData:!1,contentType:!1,success:function(e){console.log(e),$("#addListingModal").modal("hide"),$(".listingDisplay").append(`\n          <div class="card cardListStyle mb-4 listingCard" id="${e._id}" data-toggle="modal" data-target="#listingModel" data-id="${e._id}">\n            <div>\n              <img class="listingsImg" src="${url}/${e.itemImage}" class="card-img-top">\n            </div>\n\n            <div class="card-body d-flex justify-content-between flex-row">\n              <div class="col-8 col-sm-8 px-1">\n                <h6 class="card-title"> ${e.itemName}</h6>\n              </div>\n              <div class="col-4 col-sm-4 border-left px-1">\n                <small class="text-muted pl-2">$${e.itemPrice}</small>\n              </div>\n            </div>\n          </div>\n        `)},error:function(e){console.log(e),console.log("something went wrong with sending the data. Please check that your image is a png or jpeg. Any other file type will not be uploaded.")}}))}),$("#submitComment").click(function(){if(event.preventDefault(),console.log(currentCardId),sessionStorage.userID){let e=currentCardId,n=$("#comments").val();$.ajax({url:`${url}/sendComments`,type:"POST",data:{commentDescription:n,commentID:e},success:function(e){console.log(e),getCommentData(),$("#commentsDisplay").append(`\n          <div id="commentsCard" class="col-md-4">\n            <div class="card mb-4 shadow-sm">\n              <div class="card-body" id="commentBody">\n                <p class="card-text">${e.commentDescription}</p>\n                </div>\n            </div>\n          </div>\n        `)},error:function(e){console.log(e),console.log("something went wrong with sending the data")}})}else $("#comments").val(null),$("#myModal").modal("hide"),$("#invalidModal").modal("show")}),$(".listingDisplay").on("click",".listingCard",function(e){event.preventDefault(),currentCardId=$(this).data("id"),console.log(this),$.ajax({url:`${url}/listing/${currentCardId}`,type:"GET",dataType:"json",success:function(e){$("#myModal").modal("show"),$("#listingImage").empty(),$("#resultName").empty(),$("#listingCardDescription").empty(),$("#resultPrice").empty(),$("#resultSeller").empty(),$("#listingImage").append(`<img src="${url}/${e.itemImage}" class="card-img-top pt-3" style="width: 100%">`),$("#resultName").append(`${e.itemName}`),$("#listingCardDescription").append(`${e.itemDescription}`),$("#resultPrice").append(`$${e.itemPrice}`),$("#resultSeller").append(seller),getCommentData(),sessionStorage.userID?$("#userListingButtons").removeClass("d-none"):console.log("user can not update or delte")},error:function(e){console.log(e),console.log("something went wrong with getting the single product")}})}),$("#addNewListing").click(function(){event.preventDefault(),editMode=!1,$("#exampleModalLabel").text("Add listing"),sessionStorage.userID?($("#addListingModal").modal("show"),$("#itemName").val(null),$("#itemImage").val(null),$("#itemPrice").val(null),$("#itemDescription").val(null)):$("#invalidModal").modal("show")}),$("#itemImage").change(function(e){if(e.target.files.length>0){const n=e.target.files[0].name;$(this).next(".custom-file-label").html(n)}}),$("#popularItemsCards").owlCarousel({loop:!0,margin:10,responsive:{0:{items:3},600:{items:4},1000:{items:5}}}),$(document).ready(function(){$(".owl-carousel").owlCarousel()}),$("#hamburgerNav").click(function(){$("#navDropDown").hasClass("d-none")?($("#navDropDown").removeClass("d-none"),$("#navDropDown").slideDown(),$("#hamburgerNav").empty(),$("#hamburgerNav").append('<i class="fas fa-times pl-4"></i>')):($("#navDropDown").addClass("d-none"),$("#hamburgerNav").empty(),$("#hamburgerNav").append('<i class="fas fa-bars pl-4">'))}),$("#logBtn").click(function(){$("#index").addClass("d-none"),$("#signIn").removeClass("d-none"),$("#logBtn").addClass("d-none"),$("#regoBtn").addClass("d-none"),$("#logout").removeClass("d-none")}),$("#logout").click(function(){$("#logBtn").removeClass("d-none"),$("#regoBtn").removeClass("d-none"),$("#logout").addClass("d-none")}),$(".guest").click(function(){$("#index").removeClass("d-none"),$("#signIn").addClass("d-none"),$("#rego").addClass("d-none"),$("#logBtn").removeClass("d-none"),$("#regoBtn").removeClass("d-none"),$("#logout").addClass("d-none")}),$("#signInHere").click(function(){$("#index").addClass("d-none"),$("#signIn").removeClass("d-none"),$("#rego").addClass("d-none")}),$("#signUpHere").click(function(){$("#index").addClass("d-none"),$("#signIn").addClass("d-none"),$("#rego").removeClass("d-none")}),$("#submitComment").click(function(){event.preventDefault();$(this).data("id");let e=$("#comments").val();$.ajax({url:`${url}/sendComments`,type:"POST",data:{commentDescription:e},success:function(e){console.log(e),$("#comments").val(null),$("#commentsDisplay").append(`\n        <div id="commentsCard" class="col-md-4">\n          <div class="card mb-4 shadow-sm">\n            <div class="card-body" id="commentBody">\n              <p class="card-text">${e.commentDescription}</p>\n              </div>\n          </div>\n        </div>\n      `)},error:function(e){console.log(e),console.log("something went wrong with sending the data")}})});